<!DOCTYPE html>
<html lang="en" data-theme="{{ 'dark' if current_user.is_authenticated and current_user.dark_mode else 'light' }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Time Trackinator{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<nav class="nav">
  <div class="nav-container">
    <a href="{{ url_for('timeclock.dashboard') }}" class="nav-brand">
      &#9200; Time Trackinator
    </a>
    <div class="nav-links">
      {% if current_user.is_authenticated %}
        {% if current_user.is_admin %}
          <a href="{{ url_for('admin.dashboard') }}" class="nav-link">Admin</a>
        {% endif %}
        <a href="{{ url_for('timeclock.settings') }}" class="nav-link">Settings</a>
        <span class="nav-user" title="{{ current_user.email }}">
          {{ current_user.name or current_user.email.split('@')[0] }}
        </span>

        {# Theme toggle â€” submits silently via hidden form #}
        <form id="theme-form" method="POST" action="{{ url_for('timeclock.settings') }}" style="display:none">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <input type="hidden" name="action" value="theme">
        </form>
        <button type="button" class="btn-icon" onclick="document.getElementById('theme-form').submit()" aria-label="Toggle dark mode" title="Toggle dark/light mode">
          {% if current_user.dark_mode %}
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
          {% else %}
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          {% endif %}
        </button>

        <form method="POST" action="{{ url_for('auth.logout') }}" style="display:inline">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button type="submit" class="btn btn-sm">Sign Out</button>
        </form>
      {% else %}
        <a href="{{ url_for('auth.login') }}" class="btn btn-sm btn-primary">Sign In</a>
      {% endif %}
    </div>
  </div>
</nav>

<main class="main">
  <div class="container">
    {% with messages = get_flashed_messages(with_categories=True) %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endwith %}

    {% block content %}{% endblock %}
  </div>
</main>

</body>
</html>
